define("troopjs-recorder/widget/states",[],function(){return{START:"START",STOPPED:"STOPPED",DISABLE:"DISABLE",RECORDING:"RECORDING",PLAYING:"PLAYING",UPLOADING:"UPLOADING"}}),define("troopjs-recorder/service/recorder",["module","troopjs-core/component/service","recorder/require","recorder","when","lodash"],function(a,b,c,d,e,f){var g=a.config(),h=g.upload,i=g.download,j=b.create({"sig/start":function(){var a=c.toUrl("recorder.swf");d.initialize({swfSrc:a})},"hub/recorder/record":function(){var a=this;return a.publish("recorder/stop").then(function(){return a.recording=e.promise(function(b,c){d.record({start:b,progress:function(b,c){a.publish("recorder/record/progress",b),a.publish("recorder/record/volume",c)},cancel:c})})})},"hub/recorder/stop":function(){var a=this;(a.recording||a.playing)&&(d.stop(),d.encode(d.AUDIO_FORMAT_MP3),delete a.recording)},"hub/player/play":function(){var a=this;return a.publish("recorder/stop").then(function(){a.playing=e.promise(function(b){d.play({progress:function(b){a.publish("player/progress",b)},finished:function(){a.publish("player/complete").then(function(){b(),delete a.playing})}})})})},"hub/recorder/upload":function(a){return e.promise(function(b,c,e){var g=f.extend({},h,a,{success:function(a){var d=JSON.parse(a);i?d.id?b(i.url+d.id):c(d):b(d)},progress:e,error:c});d.upload(g)})}});return j.start(),j}),define("troopjs-recorder/widget/recorder",["troopjs-browser/component/widget","when","./states","../service/recorder"],function(a,b,c){var d="configuration";return a.extend(function(a,b,c){this.configure(c||{})},{"sig/start":function(){this.cls=this.$element.attr("class"),this.state(c.START)},record:function(){var a=this;return a.publish("recorder/record").then(function(){a.state(c.RECORDING)}).catch(function(){a.state(c.START)})},stop:function(){this.publish("recorder/stop")},"hub/recorder/stop":function(){var a=this;a.state()===c.RECORDING&&a.state(c.STOPPED)},"hub/recorder/record/volume":function(a){var b=this,d=b.state();d===c.RECORDING&&b.signal("volume",a)},play:function(){var a=this;a.publish("player/play").then(function(){a.state(c.PLAYING)}).otherwise(function(){a.state(c.STOPPED)})},"hub/player/complete":function(){var a=this;a.state()===c.PLAYING&&a.state(c.STOPPED)},upload:function(){var a=this,b=a[d].upload;a.publish("recorder/upload",b).then(function(b){a.signal("upload",null,b)}).otherwise(function(b){a.signal("upload",b)}),a.state(c.UPLOADING)},state:function(a){var b=this;return a&&b._state!==a&&(this.toggleState(b._state=a),b.signal("state",a)),b._state},toggleState:function(a){var b=this;b.$element.attr("class",[b.cls,a.toLowerCase()||""].join(" "))}})});